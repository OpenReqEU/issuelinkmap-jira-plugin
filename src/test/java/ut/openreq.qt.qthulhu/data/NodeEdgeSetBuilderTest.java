package ut.openreq.qt.qthulhu.data;

import com.google.gson.JsonObject;
import com.google.gson.JsonParser;
import openreq.qt.qthulhu.data.NodeEdgeSetBuilder;
import org.junit.Test;

import static org.junit.Assert.assertTrue;

public class NodeEdgeSetBuilderTest
{
    private String testIssue = "QTEX-1";

    private JsonParser parser = new JsonParser();

    @Test
    public void Hello()
    {
        String transitiveResponse = "{\"requirements\": [{\"id\": \"QTEX-1\",\"name\": \"QTEX-1-name\",\"created_at\": 0,\"modified_at\": 0,\"priority\": 7,\"requirement_type\": \"bug\",\"status\": \"completed\",\"effort\": 0,\"requirementParts\": [{\"name\": \"Resolution\",\"text\": \"Duplicate\",\"created_at\": 0},{\"name\": \"Platforms\",\"created_at\": 0},{\"name\": \"Versions\",\"text\": \"[]\",\"created_at\": 0},{\"name\": \"Labels\",\"text\": \"[]\",\"created_at\": 0},{\"name\": \"Environment\",\"created_at\": 0},{\"name\": \"Status\",\"text\": \"Closed\",\"created_at\": 0},{\"name\": \"FixVersion\",\"text\": \"No FixVersion\", \"created_at\": 0},{\"name\": \"Components\",\"text\": \"[]\",\"created_at\": 0}]},{\"id\": \"QTEX-2\",\"name\": \"QTEX-2-name\",\"created_at\": 0,\"modified_at\": 0,\"priority\": 7,\"requirement_type\": \"bug\",\"status\": \"completed\",\"effort\": 0,\"requirementParts\": [{\"name\": \"Resolution\",\"text\": \"Duplicate\",\"created_at\": 0},{\"name\": \"Platforms\",\"created_at\": 0},{\"name\": \"Versions\",\"text\": \"[]\",\"created_at\": 0},{\"name\": \"Labels\",\"text\": \"[]\",\"created_at\": 0},{\"name\": \"Environment\",\"created_at\": 0},{\"name\": \"Status\",\"text\": \"Closed\",\"created_at\": 0},{\"name\": \"FixVersion\",\"text\": \"No FixVersion\", \"created_at\": 0},{\"name\": \"Components\",\"text\": \"[]\",\"created_at\": 0}]},{\"id\": \"QTEX-3\",\"name\": \"QTEX-3-name\",\"created_at\": 0,\"modified_at\": 0,\"priority\": 7,\"requirement_type\": \"bug\",\"status\": \"completed\",\"effort\": 0,\"requirementParts\": [{\"name\": \"Resolution\",\"text\": \"Duplicate\",\"created_at\": 0},{\"name\": \"Platforms\",\"created_at\": 0},{\"name\": \"Versions\",\"text\": \"[]\",\"created_at\": 0},{\"name\": \"Labels\",\"text\": \"[]\",\"created_at\": 0},{\"name\": \"Environment\",\"created_at\": 0},{\"name\": \"Status\",\"text\": \"Closed\",\"created_at\": 0},{\"name\": \"FixVersion\",\"text\": \"No FixVersion\", \"created_at\": 0},{\"name\": \"Components\",\"text\": \"[]\",\"created_at\": 0}]},{\"id\": \"QTEX-4\",\"name\": \"QTEX-4-name\",\"created_at\": 0,\"modified_at\": 0,\"priority\": 7,\"requirement_type\": \"bug\",\"status\": \"completed\",\"effort\": 0,\"requirementParts\": [{\"name\": \"Resolution\",\"text\": \"Duplicate\",\"created_at\": 0},{\"name\": \"Platforms\",\"created_at\": 0},{\"name\": \"Versions\",\"text\": \"[]\",\"created_at\": 0},{\"name\": \"Labels\",\"text\": \"[]\",\"created_at\": 0},{\"name\": \"Environment\",\"created_at\": 0},{\"name\": \"Status\",\"text\": \"Closed\",\"created_at\": 0},{\"name\": \"FixVersion\",\"text\": \"No FixVersion\", \"created_at\": 0},{\"name\": \"Components\",\"text\": \"[]\",\"created_at\": 0}]}],\"dependencies\": [{\"dependency_type\": \"duplicates\",\"dependency_score\": 1.0,\"status\": \"accepted\",\"fromid\": \"QTEX-1\",\"toid\": \"QTEX-2\",\"description\": [\"Duplicate\"],\"created_at\": 0},{\"dependency_type\": \"duplicates\",\"dependency_score\": 1.0,\"status\": \"accepted\",\"fromid\": \"QTEX-1\",\"toid\": \"QTEX-3\",\"description\": [\"Duplicate\"],\"created_at\": 0},{\"dependency_type\": \"duplicates\",\"dependency_score\": 1.0,\"status\": \"accepted\",\"fromid\": \"QTEX-2\",\"toid\": \"QTEX-4\",\"description\": [\"Duplicate\"],\"created_at\": 0}],\"layers\": {\"0\": [\"QTEX-1\"],\"1\": [\"QTEX-2\",\"QTEX-3\"],\"2\": [\"QTEX-4\"]},\"numberOfOutpointingRelations\": 0}";
        JsonObject jsonTransitiveResponse = parser.parse(transitiveResponse).getAsJsonObject();
        JsonObject nodeEdgeSetTransitiveRepsonse = NodeEdgeSetBuilder.buildNodeEdgeSet(jsonTransitiveResponse, testIssue, false);
        assertTrue(nodeEdgeSetTransitiveRepsonse.getAsJsonArray("nodes") != null);
    }

    @Test
    public void Goodbye()
    {
        String proposedResponse = "{\"requirements\": [{\"id\": \"QTEX-5\",\"name\": \"QTEX-5-name\",\"text\": \"QTEX-5-text\",\"comments\": [],\"created_at\": 1465349468000,\"modified_at\": 1537788618000,\"priority\": 3,\"requirement_type\": \"bug\",\"status\": \"submitted\",\"requirementParts\": [{\"id\":\"QTEX-5_COMPONENTS\",\"name\": \"Components\",\"text\": \"[]\",\"created_at\": 0},{\"id\": \"QTEX-5_STATUS\",\"name\": \"Status\",\"text\": \"Reported\",\"created_at\": 1566487217818},{\"id\": \"QTEX-5_LABELS\",\"name\": \"Labels\",\"text\": \"[]\",\"created_at\": 0},{\"id\": \"QTEX-5_VERSIONS\",\"name\": \"Versions\",\"text\": \"[]\",\"created_at\": 0},{\"id\": \"QTEX-5_FIXVERSION\",\"name\": \"FixVersion\",\"text\": \"No FixVersion\",\"created_at\": 0},{\"id\": \"QTEX-5_ENVIRONMENT\",\"name\": \"Environment\",\"text\": \"\",\"created_at\": 0},{\"id\": \"QTEX-5_PLATFORMS\",\"name\": \"Platforms\",\"created_at\": 0},{\"id\": \"QTEX-5_RESOLUTION\",\"name\": \"Resolution\",\"text\": \"Unresolved\",\"created_at\": 1566487217818}]},{\"id\": \"QTEX-1\",\"name\": \"QTEX-1-name\",\"text\": \"QTEX-1-text\",\"comments\": [],\"created_at\": 1472504411000,\"modified_at\": 1559641358000,\"priority\": 3,\"requirement_type\": \"bug\",\"status\": \"completed\",\"requirementParts\": [{\"id\": \"QTEX-1_VERSIONS\",\"name\": \"Versions\",\"text\": \"[]\",\"created_at\": 0},{\"id\": \"QTEX-1_RESOLUTION\",\"name\": \"Resolution\",\"text\": \"Done\",\"created_at\": 1566487296969},{\"id\": \"QTEX-1_17412\",\"name\": \"FixVersion\",\"text\": \"5.13.0 Beta2\",\"created_at\": 0},{\"id\": \"QTEX-1_COMPONENTS\",\"name\": \"Components\",\"text\": \"[]\",\"created_at\": 0},{\"id\": \"QTEX-1_STATUS\",\"name\": \"Status\",\"text\": \"Closed\",\"created_at\": 1566487296969},{\"id\": \"QTEX-1_ENVIRONMENT\",\"name\": \"Environment\",\"text\": \"\",\"created_at\": 0},{\"id\": \"QTEX-1_LABELS\",\"name\": \"Labels\",\"text\": \"[]\",\"created_at\": 0},{\"id\": \"QTEX-1_PLATFORMS\",\"name\": \"Platforms\",\"text\": \"[]\",\"created_at\": 0}]}],\"dependencies\": [{\"id\": \"QTEX-1_QTEX-5\",\"dependency_type\": \"similar\",\"dependency_score\": 1.0,\"status\": \"proposed\",\"fromid\": \"QTEX-1\",\"toid\": \"QTEX-5\",\"description\": [\"Nikke\"],\"created_at\": 0}]}";
        JsonObject jsonProposedResponse = parser.parse(proposedResponse).getAsJsonObject();
        JsonObject nodeEdgeSetProposedResponse = NodeEdgeSetBuilder.buildNodeEdgeSet(jsonProposedResponse, testIssue, true);
        assertTrue(nodeEdgeSetProposedResponse.getAsJsonArray("nodes") != null);
    }
}